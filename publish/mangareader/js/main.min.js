var forgotRecaptcha, registerRecaptcha, malImportRecaptcha, isLoading = !1, clickedRecaptcha = !1; toastr.options.positionClass = "toast-bottom-right"; var loadedRecaptcha = !1; const getScript = e => { var t = document.createElement("script"); t.src = e, document.head.appendChild(t) }, loadCapcha = () => { setTimeout(function () { loadedRecaptcha || $.getScript("https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit").done(function (e, t) { "undefined" != typeof grecaptcha && grecaptcha.ready(() => { $("#forgot-recaptcha").length > 0 && (forgotRecaptcha = grecaptcha.render("forgot-recaptcha", { sitekey: recaptchaV2SiteKey, callback: function () { clickedRecaptcha = !0 } })), $("#register-recaptcha").length > 0 && (registerRecaptcha = grecaptcha.render("register-recaptcha", { sitekey: recaptchaV2SiteKey, callback: function () { clickedRecaptcha = !0 } })), $("#malImport-recaptcha").length > 0 && (malImportRecaptcha = grecaptcha.render("malImport-recaptcha", { sitekey: recaptchaV2SiteKey, callback: function () { clickedRecaptcha = !0 } })) }), loadedRecaptcha = !0, console.log("test") }) }, 500) }; function checkLogin() { return isLoggedIn || (loadCapcha(), $("#modal-auth").modal("show")), isLoggedIn } function paginationGetData(e) { let t = $(e).attr("data-container"); $(t).find(".loading-relative").show(), $.get($(e).attr("data-url"), function (e) { $(t).html(e.html), $(t).find(".loading-relative").hide() }) } function voteInfo() { $.get("/ajax/vote/info/" + mangaId, function (e) { e.status && $("#vote-info").html(e.html) }) } function voteSubmit(e) { isLoading || (isLoading = !0, $.post("/ajax/vote/submit", e, function (e) { e.redirectTo && (window.location.href = e.redirectTo), e.status ? ($("#vote-info").html(e.html), toastr.success(e.msg, "", { timeOut: 5e3 })) : toastr.error(e.msg, "", { timeOut: 5e3 }), isLoading = !1 })) } function readingListInfo(e) { $.get("/ajax/reading-list/info/" + mangaId + "?page=" + e, function (e) { e.status && $("#reading-list-info").html(e.html) }) } function readingListSubmit(e) { isLoading || (isLoading = !0, $.post("/ajax/reading-list/add", e, function (t) { t.redirectTo && (window.location.href = t.redirectTo), t.status ? (toastr.success(t.msg, "Success", { timeOut: 5e3 }), ["detail", "read"].indexOf(e.page) >= 0 ? $("#reading-list-info").html(t.html) : "reading-list" === e.page && window.location.reload()) : toastr.error(t.msg, "", { timeOut: 5e3 }), isLoading = !1 })) } function compareValues(e, t = "asc") { return function a(i, o) { if (!i.hasOwnProperty(e) || !o.hasOwnProperty(e)) return 0; let n = "string" == typeof i[e] ? i[e].toUpperCase() : i[e], s = "string" == typeof o[e] ? o[e].toUpperCase() : o[e]; var r = 0; return n > s ? r = 1 : n < s && (r = -1), "desc" === t ? -1 * r : r } } $(document).ready(function () { $("#modal-auth").one("click", function () { loadCapcha() }), $("body").tooltip({ selector: '[data-toggle="tooltip"]' }), $(".im-toggle").click(function (e) { $(".c_b-list").toggleClass("active") }), $("#mobile_menu").click(function (e) { $("#sidebar_menu, #mobile_menu").toggleClass("active"), $("#sidebar_menu_bg").addClass("active"), $("#search-toggle, #search, #header").removeClass("active"), $("body").toggleClass("body-hidden") }), $(".toggle-sidebar, #sidebar_menu_bg").click(function (e) { $("#sidebar_menu, #mobile_menu, #sidebar_menu_bg, #search-toggle, #search, #header").removeClass("active"), $("body").removeClass("body-hidden") }), $("#mobile_search").click(function (e) { $("#search").toggleClass("active") }), $(".nav-more .nav-link").click(function (e) { $("#sidebar_menu .sidebar_menu-list > .nav-item .nav").toggleClass("active") }), $(".detail-extend-toggle").click(function (e) { $(".detail-extend").toggleClass("active") }), $(".cbox-genres .btn-showmore").click(function (e) { $(".cbox-genres").toggleClass("active") }), $(".toggle-onoff").click(function (e) { $(this).toggleClass("active") }), $(".pc-fav").click(function (e) { $(this).toggleClass("active") }), $(".register-tab-link").click(function (e) { $("#modal-tab-register").addClass("active show"), $("#modal-tab-login").removeClass("active show") }), $(".forgot-tab-link").click(function (e) { $("#modal-tab-forgot").addClass("active show"), $("#modal-tab-login").removeClass("active show") }), $(".login-tab-link").click(function (e) { $("#modal-tab-login").addClass("active show"), $("#modal-tab-register, #modal-tab-forgot").removeClass("active show") }), $(document).on("mouseover", ".header_menu-list .nav-item", function () { $(this).find(".header_menu-sub").show() }), $(document).on("mouseout", ".header_menu-list .nav-item", function () { $(this).find(".header_menu-sub").hide() }), $('a[href*="#"].smoothlink').not('[href="#"]').not('[href="#0"]').click(function (e) { if (location.pathname.replace(/^\//, "") == this.pathname.replace(/^\//, "") && location.hostname == this.hostname) { var t = $(this.hash); (t = t.length ? t : $("[name=" + this.hash.slice(1) + "]")).length && (e.preventDefault(), $("html, body").animate({ scrollTop: t.offset().top }, 300, function () { var e = $(t); if (e.focus(), e.is(":focus")) return !1; e.attr("tabindex", "-1"), e.focus() })) } }), $("#login-form").submit(function (e) { if (e.preventDefault(), !isLoading) { isLoading = !0, $("#login-loading").show(), $("#login-error").hide(); var t = $(this).serializeArray(); $.post("/ajax/auth/login", t, function (e) { $("#login-loading").hide(), isLoading = !1, e.status ? ($("#modal-auth").modal("hide"), toastr.success(e.msg, "", { timeout: 5e3 }), window.location.reload()) : ($("#login-error").html(e.msg), $("#login-error").show()) }) } }), $("#register-form").submit(function (e) { if (e.preventDefault(), !isLoading) { isLoading = !0, $("#register-loading").show(), $("#register-error").hide(); var t = $(this).serializeArray(); $.post("/ajax/auth/register", t, function (e) { $("#register-loading").hide(), isLoading = !1, e.status ? ($("#modal-auth").modal("hide"), toastr.success(e.msg, "", { timeout: 5e3 }), window.location.reload()) : ($("#register-error").html(e.msg), $("#register-error").show(), setTimeout(function () { $("#register-error").hide() }, 5e3)), grecaptcha.reset(registerRecaptcha) }) } }), $("#forgot-form").submit(function (e) { if (e.preventDefault(), !isLoading) { $("#forgot-loading").show(), $("#forgot-error").hide(), $("#forgot-success").hide(); var t = $(this).serializeArray(); $.post("/ajax/auth/reset-password", t, function (e) { $("#forgot-loading").hide(), isLoading = !1, e.status ? ($("#forgot-form").trigger("reset"), $("#forgot-success").html(e.msg), $("#forgot-success").show()) : ($("#forgot-error").html(e.msg), $("#forgot-error").show()), setTimeout(function () { $("#forgot-error").hide(), $("#forgot-success").hide() }, 5e3), grecaptcha.reset(forgotRecaptcha) }) } }) }), $(document).on("click", ".btn-remove-cr", function () { var e = $(this).data("id"); $("#cr-loading-" + e).show(), $.post("/ajax/continue-reading/remove", { id: e }, function (e) { e.status ? ($("#manga-continue").length > 0 ? getContinueReadingHome() : window.location.reload(), toastr.success(e.msg, "", { timeOut: 5e3 })) : toastr.error(e.msg, "", { timeOut: 5e3 }) }) }), $(document).on("click", ".cm-report", function () { if (checkLogin()) { var e = $(this).data("id"), t = $(this).data("type"); $.post("/ajax/comment/report", { id: e, type: t }, function (e) { toastr.success(e.msg, "", { timeOut: 5e3 }) }) } }); var hideResults = !0, timeout = null; $("#search-suggest").mouseover(function () { hideResults = !1 }), $("#search-suggest").mouseout(function () { hideResults = !0 }), $(".search-input").keyup(function (e) { !$(this).hasClass("no-suggest") && 0 > [13, 32].indexOf(e.keyCode ? e.keyCode : e.which) && (null != timeout && clearTimeout(timeout), timeout = setTimeout(function () { timeout = null; var e = $(".search-input").val().trim(); e.length > 1 ? ($("#search-suggest").show(), $("#search-loading").show(), $.get("/ajax/manga/search/suggest?keyword=" + e, function (e) { e && ($("#search-suggest .result").html(e.html), $("#search-suggest .result").slideUp("fast"), $("#search-suggest .result").slideDown("fast"), $("#search-loading").hide()) })) : $("#search-suggest .result").empty() }, 500)) }), $(".search-input").blur(function () { hideResults && $("#search-suggest").slideUp("fast") }), $(".search-input").focus(function () { $("#search-suggest").slideDown("fast") }), $(".search-submit .search-icon").click(function () { $("#search-home-form .search-input").val().trim().length > 0 && $("#search-home-form").submit() }), $(document).on("keyup", ".search-reading-item", function (e) { if (13 !== e.keyCode) { var t = $(this).val(); if ($(".reading-item").removeClass("highlight"), t) { var a = $('.reading-list.active .reading-item[data-number="' + t + '"]'); a.length > 0 && (a.addClass("highlight"), $(".reading-list.active").scrollTo(a, { duration: 300 })) } else $(".reading-item.active").length > 0 ? $(".reading-list.active").scrollTo(".reading-item.active", { duration: 300 }) : $(".reading-list.active").scrollTo(0, { duration: 300 }) } }), $(document).on("submit", ".search-reading-item-form", function (e) { e.preventDefault(), $(".reading-item.highlight").click(), $(".reading-item").removeClass("highlight"), $(".search-reading-item").val("") }); const mangaId = $("#wrapper").data("manga-id") || null; $("#modalcharacters").on("shown.bs.modal", function () { $.get("/ajax/character/list/" + mangaId, function (e) { e.status && $("#characters-content").html(e.html) }) }), $(document).on("click", ".rl-item", function () { if (checkLogin()) { let e = $(this).data("type"), t = $(this).data("manga-id"), a = $(this).data("page"); "undefined" != typeof grecaptcha ? grecaptcha.execute(recaptchaV3SiteKey, { action: "reading_list" }).then(function (i) { readingListSubmit({ mangaId: t, type: e, page: a, _token: i }) }) : readingListSubmit({ mangaId: t, type: e, page: a, _token: "" }) } }), $(document).on("click", ".btn-vote", function () { if (checkLogin()) { $("#vote-loading").show(); var e = $(this).data("mark"); "undefined" != typeof grecaptcha ? grecaptcha.execute(recaptchaV3SiteKey, { action: "vote" }).then(function (t) { voteSubmit({ mangaId, mark: e, _token: t }) }) : voteSubmit({ mangaId, mark: e, _token: "" }) } }), $("#comment-widget").length > 0 && $.get("/ajax/comment/widget-home", function (e) { $("#comment-widget").html(e.html) }), $(document).on("click", ".notify-seen-all", function (e) { if (checkLogin()) { var t = $(this).data("position"); $.post("/ajax/notification/seen-all", function (e) { e.status ? (toastr.success(e.msg, "Success", { timeOut: 5e3 }), "header" === t ? ($(".nnl-item").removeClass("new"), $("#notify-number").remove()) : window.location.reload()) : toastr.error(e.msg, "", { timeOut: 5e3 }), e.redirectTo && (window.location.href = e.redirectTo) }) } });