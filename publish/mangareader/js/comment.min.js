var cmSort = "newest", commentLoading = !1; function getCommentWidget() { var t = `/ajax/comment/widget/${mangaId}?sort=${cmSort}`; if (currentUrl.search) { let e = new URLSearchParams(currentUrl.search); e.get("c_id") && ($("body").addClass("show-comment"), t = `${t}&cid=${e.get("c_id")}`) } $.get(t, function (t) { if (commentLoading = !1, $("#content-comments").html(t.html), t.gotoId) { let e = $("#cm-" + t.gotoId); e.addClass("comment-focus"); let i = e.data("parent-id"); i && ($(".cm-btn-show-rep[data-id=" + e.data("parent-id") + "]").click(), $("#replies-" + i + " .cw_l-line").length > 1 && $(".comments-wrap").scrollTo($("#cm-" + t.gotoId).prev(), { duration: 300 })) } }) } $(document).on("click", "#cm-view-more", function () { if (!commentLoading) { commentLoading = !0; let t = $(this), e = $(this).data("page"); $.get("/ajax/comment/list/" + mangaId + "?page=" + e + "&sort=" + cmSort, function (e) { commentLoading = !1, e && e.status && (e.nextPage > 0 ? t.data("page", e.nextPage) : t.remove(), $(".cw_list").append(e.html)) }) } }), $(document).on("click", ".cm-sort", function () { commentLoading || (commentLoading = !0, $(".cm-sort").removeClass("active"), $(".cm-sort .fa-check").hide(), $(this).addClass("active"), $(this).find(".fa-check").show(), cmSort = $(this).data("value"), getCommentWidget()) }), $(document).on("click", ".btn-spoil", function () { $(this).toggleClass("active") }), $(document).on("click", ".cm-btn-show-rep", function () { let t = $(this).data("id"); $(this).toggleClass("active"), $("#replies-" + t).slideToggle(200) }), $(document).on("click", ".show-spoil", function () { $(this).hide(), $(this).parent().removeClass("is-spoil") }), $(document).on("click", ".ib-reply,.btn-close-reply", function () { checkLogin() && $("#reply-" + $(this).data("id")).slideToggle(100) }), $(document).on("focus", "#df-cm-content", function () { checkLogin() && $("#df-cm-buttons").slideDown(100) }), $(document).on("click", "#df-cm-close", function () { $("#df-cm-buttons").slideUp(100) }), $(document).on("click", ".cm-btn-vote", function () { if (checkLogin() && !commentLoading) { commentLoading = !0; let t = $(this), e = parseInt(t.data("type")), i = t.data("id"), n = $(".cm-btn-vote[data-id=" + i + "].active"); if (n.length > 0 && parseInt(n.data("type")) !== e) { n.removeClass("active"); var o = parseInt(n.find(".value").text()); o > 0 && (o -= 1, n.find(".value").text(o > 0 ? o : "")) } t.toggleClass("active"); var a = parseInt(t.find(".value").text()); a = a > 0 ? t.hasClass("active") ? a + 1 : a - 1 : 1, t.find(".value").text(a > 0 ? a : ""), $.post("/ajax/comment/vote", { id: i, type: e }, function (t) { commentLoading = !1 }) } }), $(document).on("submit", ".comment-form", function (t) { if (t.preventDefault(), !commentLoading) { commentLoading = !0; let e = $(this), i = $(this).find(".loading-absolute"); i.show(); var n = $(this).serializeArray(); n.push({ name: "manga_id", value: mangaId }), n.push({ name: "chapter_id", value: readingId }), n.push({ name: "is_spoil", value: $(".btn-spoil").hasClass("active") ? 1 : 0 }), $.post("/ajax/comment/add", n, function (t) { if (commentLoading = !1, i.hide(), t && t.status) { if (parseInt(t.parentId) > 0) { let n = $("#cm-" + t.parentId + " .replies"); n.length > 0 ? n.html(t.html) : $("#cm-" + t.parentId).append('<div class="replies">' + t.html + "</div>"), $("#replies-" + t.parentId).slideToggle(100), $("#reply-" + t.parentId).slideToggle(100) } else $("#df-cm-buttons").slideUp(100), $(".cw_list").html(t.html); e[0].reset(), e.find(".btn-spoil").removeClass("active") } }) } });
